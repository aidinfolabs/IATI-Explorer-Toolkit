<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">

<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>IATI Explorer Toolkit</title>
	<meta name="author" content="Timothy Davies">
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script> 	
	<script><!--
		$(document).ready(function() {
			query_prefix = "http://opendatacookbook.net:8080/exist/rest//db/iati/";
			root_element = "iati-activity";
			xsl ="";
			
			$("#query-builder select, #query-builder input").change(function() {
					xpath = "//" + root_element + "";
					combine = "";
				$("#query-builder select").each(function(){
					if($(this).val()) {
						if($(this).attr("multiple")) {
							xpath_element = "["; element_combine = "";
							$(this).find(":selected").each(function(i, selected){
								xpath_element = xpath_element + element_combine + $(selected).parent().attr("name") + "='"+$(selected).val()+"'";
								element_combine = " or ";
							});	
							xpath = xpath + combine + xpath_element;
						} else {
							xpath = xpath + combine + $(this).attr("name") + "='"+$(this).val()+"'";
						}
						combine = "][";
					}
				});				
				
				xpath = xpath + "]";
				
				$("#query").val(xpath);
				if(xsl) {
					$("#querylink").html("<a href=\""+query_prefix+"?_xpath="+xpath+"&_xsl="+xsl+"\" target='_blank'>Run Query</a>");
				} else {
					$("#querylink").html("<a href=\""+query_prefix+"?_xpath="+xpath+"\" target='_blank'>Run Query</a>");
				}
			});	
		});
	--></script>
	
</head>
<body>
	
	<form id="query-builder">
		<input name="query" id="query" type="text" size="100"/>
		<span id="querylink"></span>
		
		<select name="recipient-country/@code" MULTIPLE>
			<option value="">--Select--</option>
			<option value="NP">Nepal</option>
			<option value="GH">Ghana</option>
		</select>
		
		<input type="checkbox" name="option1" value="">
			
		<select name="participating-org/@ref">
			<option value="">--Select--</option>
			<option value="GB">Great Britain</option>
			<option value="UN">UN</option>
		</select>
	</form>



</body>
</html>
